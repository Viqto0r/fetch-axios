<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fetch/Axios</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <style>
      body {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
      }
      .section {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
      }
      button {
        margin: 5px;
        padding: 8px 15px;
      }
      .loading {
        color: blue;
        font-weight: bold;
      }
      .error {
        color: red;
        font-weight: bold;
      }
      pre {
        background: #f5f5f5;
        padding: 10px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <h1>Fetch/Axios</h1>

    <div class="section">
      <h2>Fetch API</h2>
      <button onclick="getDataUsingFetch()" id="fetchGetBtn">
        Запросить данные
      </button>
      <button onclick="postDataUsingFetch()" id="fetchPostBtn">
        Отправить данные
      </button>
      <button onclick="cancelFetch()" id="fetchCancelBtn" disabled>
        Отменить
      </button>

      <div id="fetchStatus"></div>
      <pre id="fetchOutput"></pre>
    </div>

    <div class="section">
      <h2>Axios</h2>
      <button onclick="getDataUsingAxios()" id="axiosGetBtn">
        Запросить данные
      </button>
      <button onclick="postDataUsingAxios()" id="axiosPostBtn">
        Отправить данные
      </button>
      <button onclick="cancelAxios()" id="axiosCancelBtn" disabled>
        Отменить
      </button>

      <div id="axiosLogs"></div>

      <div id="axiosStatus"></div>
      <pre id="axiosOutput"></pre>
    </div>

    <script>
      let fetchController = null
      let axiosCancelToken = null

      const getDataUsingFetch = async () => {
        const status = document.getElementById('fetchStatus')
        const output = document.getElementById('fetchOutput')
        const cancelBtn = document.getElementById('fetchCancelBtn')
        const postBtn = document.getElementById('fetchPostBtn')

        status.innerHTML = '<div class="loading">Loading...</div>'
        output.textContent = ''
        cancelBtn.disabled = false
        postBtn.disabled = true

        fetchController = new AbortController()

        try {
          const response = await fetch(
            'https://jsonplaceholder.typicode.com/posts/1',
            {
              signal: fetchController.signal,
            }
          )

          if (!response.ok) throw new Error(`HTTP error: ${response.status}`)

          const data = await response.json()
          output.textContent = JSON.stringify(data, null, 2)
          status.innerHTML = ''
        } catch (error) {
          if (error.name === 'AbortError') {
            status.innerHTML = '<div class="error">Прервано</div>'
          } else {
            status.innerHTML = `<div class="error">Ошибка: ${error.message}</div>`
          }
        } finally {
          cancelBtn.disabled = true
          postBtn.disabled = false
        }
      }

      const postDataUsingFetch = async () => {
        const status = document.getElementById('fetchStatus')
        const output = document.getElementById('fetchOutput')
        const cancelBtn = document.getElementById('fetchCancelBtn')
        const getBtn = document.getElementById('fetchGetBtn')

        status.innerHTML = '<div class="loading">POST Loading...</div>'
        output.textContent = ''
        cancelBtn.disabled = false
        getBtn.disabled = true

        fetchController = new AbortController()

        try {
          const postData = {
            title: 'Fetch POST Request',
            body: 'This is a POST request from Fetch API',
            userId: 1,
          }

          const response = await fetch(
            'https://jsonplaceholder.typicode.com/posts',
            {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(postData),
              signal: fetchController.signal,
            }
          )

          if (!response.ok) throw new Error(`HTTP error: ${response.status}`)

          const data = await response.json()
          output.textContent = JSON.stringify(data, null, 2)
          status.innerHTML = '<div style="color: green;">POST ✅ Успешно!</div>'
        } catch (error) {
          if (error.name === 'AbortError') {
            status.innerHTML = '<div class="error">POST ❌ Прервано</div>'
          } else {
            status.innerHTML = `<div class="error">POST ❌ Ошибка: ${error.message}</div>`
          }
        } finally {
          cancelBtn.disabled = true
          getBtn.disabled = false
        }
      }

      const cancelFetch = () => {
        if (fetchController) {
          fetchController.abort()
        }
      }

      const addLog = (message) => {
        const logsDiv = document.getElementById('axiosLogs')
        const logElement = document.createElement('div')

        logElement.className = 'log'
        logElement.textContent = `${new Date().toLocaleTimeString()} - ${message}`
        logsDiv.appendChild(logElement)

        const logs = logsDiv.getElementsByClassName('log')
      }

      axios.interceptors.request.use((config) => {
        addLog(`ЗАПРОС: ${config.method?.toUpperCase()} ${config.url}`)

        return config
      })

      axios.interceptors.response.use((config) => {
        const { status, responseURL } = config.request

        addLog(`Ответ: статус - ${status} ${responseURL}`)

        return config
      })

      const getDataUsingAxios = async () => {
        const status = document.getElementById('axiosStatus')
        const output = document.getElementById('axiosOutput')
        const cancelBtn = document.getElementById('axiosCancelBtn')
        const postBtn = document.getElementById('axiosPostBtn')

        status.innerHTML = '<div class="loading">Loading...</div>'
        output.textContent = ''
        cancelBtn.disabled = false
        postBtn.disabled = true

        axiosCancelToken = axios.CancelToken.source()

        try {
          const response = await axios.get(
            'https://jsonplaceholder.typicode.com/posts/2',
            {
              cancelToken: axiosCancelToken.token,
            }
          )

          output.textContent = JSON.stringify(response.data, null, 2)
          status.innerHTML = ''
        } catch (error) {
          if (axios.isCancel(error)) {
            status.innerHTML = '<div class="error">Прервано</div>'
          } else {
            status.innerHTML = `<div class="error">Ошибка: ${error.message}</div>`
          }
        } finally {
          cancelBtn.disabled = true
          postBtn.disabled = false
        }
      }

      const postDataUsingAxios = async () => {
        const status = document.getElementById('axiosStatus')
        const output = document.getElementById('axiosOutput')
        const cancelBtn = document.getElementById('axiosCancelBtn')
        const getBtn = document.getElementById('axiosGetBtn')

        status.innerHTML = '<div class="loading">POST Loading...</div>'
        output.textContent = ''
        cancelBtn.disabled = false
        getBtn.disabled = true

        axiosCancelToken = axios.CancelToken.source()

        try {
          const postData = {
            title: 'Axios POST Request',
            body: 'This is a POST request from Axios',
            userId: 1,
          }

          const response = await axios.post(
            'https://jsonplaceholder.typicode.com/posts',
            postData,
            {
              cancelToken: axiosCancelToken.token,
            }
          )

          output.textContent = JSON.stringify(response.data, null, 2)
          status.innerHTML = '<div style="color: green;">POST ✅ Успешно!</div>'
        } catch (error) {
          if (axios.isCancel(error)) {
            status.innerHTML = '<div class="error">POST ❌ Прервано</div>'
          } else {
            status.innerHTML = `<div class="error">POST ❌ Ошибка: ${error.message}</div>`
          }
        } finally {
          cancelBtn.disabled = true
          getBtn.disabled = false
        }
      }

      const cancelAxios = () => {
        if (axiosCancelToken) {
          axiosCancelToken.cancel('Запрос отменен')
        }
      }
    </script>
  </body>
</html>
